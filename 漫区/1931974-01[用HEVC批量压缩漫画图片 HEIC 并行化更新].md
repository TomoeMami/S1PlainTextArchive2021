> ## **本文件最后更新于2020-05-16 00:07** 



*****

####  冰箱研会长  
##### 1#       楼主       发表于 2020-5-2 11:13



 本帖最后由 冰箱研会长 于 2020-5-13 08:34 编辑 

<strong>2020年5月13日08点33分</strong>
<strong>更新回复中推荐的MM+heic插件:</strong>
<strong>链接：[https://pan.baidu.com/s/1oPMqm1btNujXvbxoM7V0UA](https://pan.baidu.com/s/1oPMqm1btNujXvbxoM7V0UA) 
以下内容需要积分高于 9000 才可浏览
<strong>提取码：vfbm
</strong>
</strong>

<strong>--------------
</strong>
<strong>2020年5月8日16点46分</strong>

<strong>脚本已经完全并行化 处理速度大涨 使用方法没有改变 具体可见github
</strong>
<strong>------------
</strong>
<strong>2020年5月7日19点41分更新</strong>

<strong>有一个地方搞错了 只要安装imagemagick 你就会自动获得一份ffmpeg 
</strong>
<strong>所以ffmpeg不需要额外安装了
</strong>
<strong>-------------
</strong>
<strong>2020年5月6日</strong>
<strong>我的配置文件:</strong>
<strong>[https://github.com/GrandArth/Risi-Pwsh-Profile](https://github.com/GrandArth/Risi-Pwsh-Profile)
</strong>

<strong>----
</strong>
<strong>2020年5月6日14点00分 更新色彩空间科普</strong>

<strong>----------
</strong>
<strong>2020年5月5日07点01分 感谢捉虫</strong>

<strong>-----------
</strong>
<strong>2020年5月4日18点57分</strong>


感谢回复提到的yuv420<strong>隔行采样</strong>的问题

如果是彩**片 这里<strong>应该使用yuv444达到彻底无损的转码</strong>

然而444采样我在win10上<strong>找不到</strong>任何<strong>支持的软件</strong>

事实上420的10bit模式就已经让一堆软件阵亡了

但是苹果手机 无论是对444-10 还是 444-8 还是420-10 都可以正常解码.


这里就<strong>仅仅推荐IOS用户采用如下参数</strong>: #for yuv444 and yuv44410le use following code #8-bit yuv444 ffmpeg -i $_.FullName  -crf $crfval  -pix_fmt yuv444p -sws_flags spline+accurate_rnd+full_chroma_int -color_range 1 -colorspace 5 -color_primaries 5 -color_trc 6  -f hevc "$($_.Directory)\$($_.Basename).hvc"; #10-bit yuv444 ffmpeg -i $_.FullName  -crf $crfval  -pix_fmt yuv444p10le -sws_flags spline+accurate_rnd+full_chroma_int -vf "colormatrix=bt470bg:bt709" -color_range 1 -colorspace 1 -color_primaries 1 -color_trc 1   -f hevc "$($_.Directory)\$($_.Basename).hvc"; 复制代码
当然.. <strong>这里我们说的是彩**片的无损转码</strong> 如果是你是<strong>黑白图片</strong>的话就<strong>没有什么可担心的</strong>



----------------------------


2020年5月4日09点44分 <strong>新增对比包</strong>


mlgb的 我截了一堆对比图 tm的不小心安了个退格, 退到了第一节 写的东西全没了.

这里就放个结论吧:
<strong>文件在这里:</strong>https://send.firefox.com/download/e8f68ffe9bcd7b9f/#OMlIB0ImvlTPpU5ktRyZOg

crf设置为0的时候已经可以正常压缩jpg 减小的体积占5%左右
<strong>crf设置为10的时候 体积已经可以稳定减少50% 2000%很难找到色块变化</strong>
同时webp设置为无损和85%的时候 体积<strong>不减反增</strong> 找不到明显的色块变化
<strong>crf20</strong> 和<strong>webp 45%</strong>的时候 二者体积均下降到原来的<strong>1/4</strong>上下 可以看到低频区相比原图有明显的高频损失
crf30的时候 体积已经是原来的<strong>1/10</strong>, 高频信息少量丢失


<strong>之所以会有这样的差别 说白还是webp编码支持的预测模式比较少, 就算放宽一点质量参数, vp8预测不了只能直接压缩的部分很可能仍然不满足条件, 只能直接压缩.</strong>
<strong>而hevc的预测模式那么多, 条件稍微放宽一点, 就有大量的色块可以被准确预测, 自然在压缩率上表现比较好.</strong>
 
<strong>----------------
</strong>
<strong>可能是最后一次更新 20点58分</strong>
<strong>整合了所有题外话里面的优化的最终版本imgconv函数 + 仅仅使用ffmpeg实现编码的fimgconv(高速的代价是你也许会损失边缘的一列/行像素)</strong>
<strong>顺便优化了帧文件的删除
|</strong>  #批量删除 function mdel($tpath, $tformat){         dir -recurse -path $tpath -include *.$tformat |%{                 $_.Delete();         } }  #普通版 function imgconv($tpath, $quality,$sformat ,$tformat) {         If($tformat -eq "heic")         {                 dir -recurse -path $tpath -include *.$sformat |%{                         $extentmark = 0;                         $imwidth=magick identify -ping -format "%w" $_.FullName                         $imwidth=[int]$imwidth;                         If(($imwidth)%2 -ne 0)                         {                                 $imwidth=$imwidth+1;                                 $extentmark=1;                                 }                         $imheight=magick identify -ping -format "%h" $_.FullName;                         $imheight=[int]$imheight;                         If(($imheight)%2 -ne 0)                         {                                 $imheight=$imheight+1;                                 $extentmark=1;                         }                         If($extentmark)                         {                                 magick $_.FullName -gravity center -strip -extent "($imwidth)x($imheight)" -quality 100% $_.FullName;                         }                 }                  dir -recurse -path $tpath -include *.$sformat |%{                         $crfoffset = $quality * 10;                         $crfval= 30 - $crfoffset;                         ffmpeg -i $_.FullName  -crf $crfval  -pix_fmt yuv420p -sws_flags spline+accurate_rnd+full_chroma_int -color_range 1 -colorspace 5 -color_primaries 5 -color_trc 6   -f hevc "$($_.Directory)\$($_.Basename).hvc";                         MP4Box -add-image "$($_.Directory)\$($_.Basename).hvc:primary" -ab heic -new "$($_.Directory)\$($_.Basename).heic";                 }                 mdel $tpath hvc }         Else {         dir -recurse -path $tpath -include *.$sformat |%{                 $quality=[int]$quality;                 $magickquality=$quality * 100;                 #$magickquality="$magickquality"+"%";                 magick $_.FullName -quality $magickquality -interlace Plane -sampling-factor 4:2:0 -strip "$($_.Directory)\$($_.Basename).$tformat";                 } } }   #图像分辨率有奇数的时候会损失一列/行像素的高速版 function fimgconv($tpath, $quality,$sformat ,$tformat) {         echo "This may delete one column/row of pixels!!!!!!!"         If($tformat -eq "heic")         {                 dir -recurse -path $tpath -include *.$sformat |%{                         $crfoffset = $quality * 10;                         $crfval= 30 - $crfoffset;                         ffmpeg -i $_.FullName -c:v libx265 -crf $crfval -vf "crop=trunc(iw/2)*2:trunc(ih/2)*2" -pix_fmt yuv420p  -sws_flags spline+accurate_rnd+full_chroma_int -color_range 1 -colorspace 5 -color_primaries 5 -color_trc 6   -f hevc "$($_.Directory)\$($_.Basename).hvc";                         MP4Box -add-image "$($_.Directory)\$($_.Basename).hvc:primary" -ab heic -new "$($_.Directory)\$($_.Basename).heic";                 }                 mdel $tpath hvc }         Else {         dir -recurse -path $tpath -include *.$sformat |%{                 $quality=[int]$quality;                 $magickquality=$quality * 100;                 #$magickquality="$magickquality"+"%";                 magick $_.FullName -quality $magickquality -interlace Plane -sampling-factor 4:2:0 -strip "$($_.Directory)\$($_.Basename).$tformat";                 } } }  复制代码|


<strong>-------------------------
</strong>
<strong>2020年5月3日16点47分更新</strong>
<strong>关于如何安装ffmpeg</strong>
<strong>这一部分内容正确, 然而Imagemagick会自动安装ffmpeg, 不需要额外手动安装了
</strong>
<strong>1. 打开下载下来的压缩包 
</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165246.jpg" referrerpolicy="no-referrer">
</strong>
<strong>2. 解压到一个文件夹里
</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165311.jpg" referrerpolicy="no-referrer"></strong>
<strong>3.找一个你喜欢的地方把他放进去</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165352.jpg" referrerpolicy="no-referrer"></strong>

<strong>4.复制bin文件夹的路径</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165416.jpg" referrerpolicy="no-referrer"></strong>

<strong>5.打开path</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165432.jpg" referrerpolicy="no-referrer"></strong>

<strong>6.进入path</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165456.jpg" referrerpolicy="no-referrer"></strong>

<strong>7.编辑path</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165600.jpg" referrerpolicy="no-referrer"></strong>

<strong>8.新建一个路径</strong>
<strong><img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503165638.jpg" referrerpolicy="no-referrer"></strong>

<strong>9.粘贴你最开始复制的bin文件夹的路径到这里</strong>
<strong>一路确定结束安装
</strong>
<strong>-----------------
</strong>

<strong>2020年5月3日07点54分 新增原理科普 解释了heic为什么nb</strong>

<strong>----------------
</strong>
<strong>更新了对比图 2020年5月2日 15点15分</strong>


--------------
<strong>正文</strong>

前两天看到aji47有关漫画阅读器的帖子:
[https://bbs.saraba1st.com/2b/thread-1924064-1-1.html](https://bbs.saraba1st.com/2b/thread-1924064-1-1.html)

一方面感叹楼主的行动力, 一方面也发现还有很多人也在本地保存着喜欢的漫画.


任何种类的收藏在达到一定规模之后必然会逐步提高对储存介质容量的需求.

在图片储存这方面, 一个高效的格式, 可以在画质无损的情况下以极大的比率减少文件所需要的储存空间.


然而优秀的图片格式有很多种, 但并不是每种都得到了广泛支持.

号称最高压缩比的Flif, 已经不知道多久没更新了.

据称性能最好的BGP, 连解码器都需要自己编译.

如果你的图片规格是哪儿哪儿用着都费劲, 转换格式其实也是自找麻烦.


所幸, 除了png jpg gif 这类古董货之外, 我们是有一个泛用性高, 压缩比高, 渲染性能优秀的图片格式的,

那就是
webp(划掉)

说错了...

那就是
HEIC!


关于heic的起源和爸爸们, 还有它和webp的恩怨, 想了解的还请自行百度, 看完之后说不定你也会高呼 "万恶的资本主义"


heic本身其实不是图片格式, 而是一种容器(里面甚至可以放json), 这里我们所说的是heic格式的图片, 不是heic封装jpg png webp, 而是<strong>封装了.265编码的一帧的heic</strong>


至于.265, 对视频压制有了解的各位或多或少知道这个编码的性能是如何优秀, 这里我们要做的, 就是利用这个性能, 对原有的图片重新编码封装, 达到无损转换图片, 节省空间的目的.

<strong>前期准备</strong>
1. FFmpeg(被ImageMagick包含 不需要额外下载)
2.ImageMagick
3.Mp4box
<strong>4.Hevc图像扩展
</strong><strong>(可选): 第三方图片阅读器</strong>
<strong>只想看heic, 只需要进行第四步和可选即可
</strong>


1-3 下载各自的软件包:
[https://ffmpeg.zeranoe.com/builds/](https://ffmpeg.zeranoe.com/builds/)
<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502094912.png" referrerpolicy="no-referrer">
[https://imagemagick.org/download ... -10-Q16-x64-dll.exe](https://imagemagick.org/download/binaries/ImageMagick-7.0.10-10-Q16-x64-dll.exe)

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502095004.png" referrerpolicy="no-referrer">
[https://gpac.wp.imt.fr/downloads/gpac-nightly-builds/](https://gpac.wp.imt.fr/downloads/gpac-nightly-builds/)
<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502095133.png" referrerpolicy="no-referrer">


4.

(可选): 切换win10地区设置为美国

<strong>(必选):</strong>
[https://www.microsoft.com/en-us/ ... 7593_1243925&amp;tduid=](https://www.microsoft.com/en-us/p/hevc-video-extensions-from-device-manufacturer/9n4wgh0z6vhq?ocid=AID2000142_aff_7593_1243925&amp;tduid=)$ir__1lik369jrkkftjh9kk0sohzx0e2xngsgfopfoxd900$$7593$$1243925$$dquE8U2QoAw-vAQJT5WIzcashB34AtLacA$$$&amp;ranMID=24542&amp;ranEAID=dquE8U2QoAw&amp;ranSiteID=dquE8U2QoAw-vAQJT5WIzcashB34AtLacA&amp;epi=dquE8U2QoAw-vAQJT5WIzcashB34AtLacA&amp;irgwc=1&amp;irclickid=_1lik369jrkkftjh9kk0sohzx0e2xngsgfopfoxd900&amp;wa=wsignin1.0&amp;activetab=pivot:overviewtab 
<strong>上面的链接好像不好使?</strong>
[https://www.microsoft.com/en-us/ ... cturer/9n4wgh0z6vhq](https://www.microsoft.com/en-us/p/hevc-video-extensions-from-device-manufacturer/9n4wgh0z6vhq)<strong>使用微软账号购买安装此免费视频扩展</strong>

<strong>(必选):
</strong><strong>在微软商店搜索heic图像扩展, 安装, 也是免费的. 之所以上面那个提供链接, 是因为只有美区有, 国区搜索不到.</strong>
<strong>回复中有人提供了国区链接
</strong>


5.(可选) 第三方阅读器 Xnview MP

在完成了前四步之后, 你的电脑应该已经可以无障碍查看heic图像了(默认照片程序).

如果你想使用第三方阅读器来统一阅读体验(假设你还需要阅读webp), 那么我建议你安装xnview, 及其heic扩展:
[https://newsgroup.xnview.com/viewtopic.php?t=36661](https://newsgroup.xnview.com/viewtopic.php?t=36661)
<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502095724.png" referrerpolicy="no-referrer">

这里所说的heic和heif是一回事.

<strong>批量转换你的图片</strong>
<strong>#具体实现没有兴趣直接拉到最后</strong>
<strong>
</strong>
转换的流程如下:
解码图片 编码图片 封装成heic


在仅仅考虑这些的条件下, 我们只要ffmpeg就可以解决:
                         ffmpeg -i "$($_.Directory)\$($_.Basename).$sformat" -crf $crfval  -preset veryslow -tune grain  -pix_fmt yuv420p10le -f hevc "$($_.Directory)\$($_.Basename).hvc"; MP4Box -add-image "$($_.Directory)\$($_.Basename).hvc:primary" -ab heic -new "$($_.Directory)\$($_.Basename).heic"; rm "$($_.Directory)\$($_.Basename).hvc"; 复制代码-i 后面是输入文件地址 -crt是质量参数 越低越好 0 为无损 后面的""内的是输出文件的地址. 


输出之后使用mp4box封装, 然后移除帧文件, 里面所有$开头的都是powershell设定的变量, 因为这是直接从我的函数中截取出来的, 所以可读性差一点.

熟悉powershell的朋友可能看出来这些大部分都是 管道传递的对象的属性. 



然而hevc编码有一个问题, 那就是编码文件的时候, 只接受 "长宽都是偶数的图片". 然而图片大小这种东西...讲道理虽然是视频常见的分辨率就那么几种, 图片的分辨率则是千差万别.

ffmpeg虽然内置了一个拉伸算法来允许你对图像进行拉伸, 


然而这种加减一个像素的拉伸, 在这些本应用于  成倍缩放的情景中   的算法手下会产生极为糟糕的后果.

反映到漫画上来, 就是细节纹理恶化, 网点全灭.


由于上述原因, 这里我采用的是对图像平铺扩展的方式进行大小改变.         magick $_.FullName -gravity center -extent "($imwidth)x($imheight)" -quality 100% "$($_.Directory)\$($_.Basename).$sformat";复制代码通过将图像至于大了半圈的底板中心 (其实不那么中心, 偶数怎么可能有中心呢?)里,

来让图像满足hevc编码的条件.

在成品的函数中, 我是用判断余数的方式自动设置了缩放参数.

!!!!! 注意 这里会<strong>直接在原图的基础上进行修改</strong>, 图片<strong>质量不会变化</strong>, 只是多了一圈像素,

但为了规避可能的失误操作, 在<strong>处理之前</strong>请复制一些文件<strong>进行测试</strong>



到这里两步, 必要的工作都已经结束了.

用过power shell的 get children 获取对象, 依次传递到管道执行命令就可以完成格式转换.

因为其他图像格式之间的转换不需要ffmepg, imagemagic就可以支持, 所以加了一个判断目标格式的if在里面,

其他情况都是使用IM, heic时使用ffmpeg.

顺便说一句, win10的image magick是支持hevc解码的, 也就是说它可以从heic转出, 而不能转入.


下面就是完整的函数了,.

在"我的文档\WindowsPowerShell"文件夹下新建一个名为:

Microsoft.PowerShell_profile.ps1

的空文件, 使用记事本打开, 粘贴下面的函数保存.

紧急修正! 函数现已使用8bit YUV色彩空间, win10的扩展不支持10bit的hevc!!!
第二次修正, 有人评论<strong>色彩空间</strong>的问题, 我找了几个彩**片试了一下, 确实需要进一步修正.
这里使用<strong>colormatrix</strong>对原图的色彩空间到新的色彩空间做了变换, 也启用了回复中的无损参数
<strong>扩展阅读:[https://trac.ffmpeg.org/wiki/colorspace](https://trac.ffmpeg.org/wiki/colorspace)
ffmpegWIKI中对色彩空间变换的解释和例子.</strong>
我找了几个pixiv的图试了一下, 色彩空间映射基本完美了.
不过这个东西 源头不同 需要的参数也不同 不能一概而论
所以要是有谁发现变换之后色彩不一样了 可以发出来大家一起研究一下
| function imgconv($tpath, $quality,$sformat ,$tformat) {     If($tformat -eq "heic")     {         dir -recurse -path $tpath -include *.$sformat |%{             $extentmark = 0;             $imwidth=magick identify -ping -format "%w" $_.FullName             $imwidth=[int]$imwidth;             If(($imwidth)%2 -ne 0)             {                 $imwidth=$imwidth+1;                 $extentmark=1;                 }             $imheight=magick identify -ping -format "%h" $_.FullName;             $imheight=[int]$imheight;             If(($imheight)%2 -ne 0)             {                 $imheight=$imheight+1;                 $extentmark=1;             }             If($extentmark)             {                 magick $_.FullName -gravity center -extent "($imwidth)x($imheight)" -quality 100% "$($_.Directory)\$($_.Basename).$sformat";             }         }          dir -recurse -path $tpath -include *.$sformat |%{             $crfoffset = $quality * 10;             $crfval= 11 - $crfoffset;             ffmpeg -i "$($_.Directory)\$($_.Basename).$sformat"  -crf $crfval -x265-params lossless=1:range=full -dst_range 1 -pix_fmt yuv420p -sws_flags spline+accurate_rnd+full_chroma_int -color_range 1 -colorspace 5 -color_primaries 5 -color_trc 6  -f hevc "$($_.Directory)\$($_.Basename).hvc";             MP4Box -add-image "$($_.Directory)\$($_.Basename).hvc:primary" -ab heic -new "$($_.Directory)\$($_.Basename).heic";             rm "$($_.Directory)\$($_.Basename).hvc";         } }     Else {     dir -recurse -path $tpath -include *.$sformat |%{         $quality=[int]$quality;         $magickquality=$quality * 100;         #$magickquality="$magickquality"+"%";         magick $_.FullName -quality $magickquality -interlace Plane -sampling-factor 4:2:0 -strip "$($_.Directory)\$($_.Basename).$tformat";         } } }  复制代码|
然后使用<strong>管理员身份</strong>打开powershell, 设置执行策略 (如果一切正常, 你打开powershell的时候应该会报错说什么权限啊 策略啊之类的问题)
 set-executionpolicy remotesigned 复制代码完成之后重启powershell即可使用上方函数.


用法如下


在powershell中输入 imgconv "图片所在的目标文件夹"  质量参数 原图格式 目标格式 #例子一 jpg转heic  #这里用的函数是最上方的那个 crf基础为30 质量参数设为1时crf为20 crf设置为3时进行无损转换 imgconv "D:\Download\manga\Akira" 3 jpg heic #例子二 jpg和png之间互相转换 #当目标格式不是heic的时候 转换仅仅使用imagemagick进行 #这是质量参数会映射为百分比 #即1=100%质量 0.75=75%质量 #在目标格式heic的时候 质量参数是对基础crf的改变  #这里则是直接的百分比映射 imgconv "D:\Download\Manga\bababababa" 1 jpg png #例子三 快速转换 #"快速" 这一特点仅仅在目标为heic时有效 #可能会导致你损失一列像素 fimgconv  "D:\Download\manga\Akira" 3 jpg heic复制代码即可递归查找目标路径下所有 <strong>原图格式</strong> 的图片 转换为 <strong>目标格式.</strong>

<strong>题外话</strong>
其实webp也是相当不错的选择, 不过我是苹果用户, 而苹果对webp的支持真是一言难尽....
顺便, 有人知道怎么用sharex上传图片到gitee么..

<strong>题外话2</strong>

这个是链接里的那个扩展, 美区有免费版的 国区只有收费版的...

如果这个找不到的话可以试试第三方的浏览器

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502120101.jpg" referrerpolicy="no-referrer">
<strong>题外话3</strong>


推荐一个ios上的支持webp heic的漫画阅读器 里世界

功能和别的阅读器比起来属于被秒杀的类型 但是支持heic和webp 但是支持heic和webp 但是支持heic和webp 但是支持heic和webp

<strong>题外话4</strong>


xnview支持10bit解码 所以如果你使用xnview 可以:                         ffmpeg -i "$($_.Directory)\$($_.Basename).$sformat" -crf $crfval  -preset veryslow -tune grain  -pix_fmt yuv420p -f hevc "$($_.Directory)\$($_.Basename).hvc";复制代码这一行改成:      ffmpeg -i "$($_.Directory)\$($_.Basename).$sformat" -crf $crfval -preset veryslow -tune grain -pix_fmt yuv420p10le -f hevc "$($_.Directory)\$($_.Basename).hvc";复制代码现在支持heic的阅读器 比如 imageglass 大多都是8bit only 所以为了兼容性 还是使用8bit模式就行

但是苹果支持10bit 23333

<strong>题外话5</strong>
我其实很想发个对比图...但是我的都处理完了.....



<strong>题外话6</strong>
虽然现在(2020年5月2日14点40分)的函数里面启用了无损模式 -x265-params lossless=1:range=full 复制代码但是因为后面一系列色彩操作优化还不是很好 所以压缩比并不是很理想

如果想要在这个基础上达到比较高的压缩比

去掉lossless=1
<strong>
</strong><strong>题外话7</strong>

如果上面的你觉得也不行 可以试试这个 这个是我现在用的 使用函数的时候 参数给低一点也无所谓 (目前设置最高1 最低0.1)

我很懒, 你仔细看函数里面参数映射那里就会发现, 无论你怎么调节输入, crt的范围永远都低于<strong>无肉眼可见损失</strong>的范围 


所以你可以随便改改 把$crfval的初始值设置成30啥的 (现在是11), 能压缩的更好.
             ffmpeg -i "$($_.Directory)\$($_.Basename).$sformat"  -crf $crfval -x265-params range=full -dst_range 1 -pix_fmt yuv420p -sws_flags spline+accurate_rnd+full_chroma_int -vf "colormatrix=bt470bg:bt709" -color_range 1 -colorspace 1 -color_primaries 1 -color_trc 1  -f hevc "$($_.Directory)\$($_.Basename).hvc";复制代码<strong>
</strong>
<strong>题外话8</strong>

最最最最最最终参数
                         ffmpeg -i $_.FullName  -crf $crfval  -pix_fmt yuv420p -sws_flags spline+accurate_rnd+full_chroma_int -color_range 1 -colorspace 5 -color_primaries 5 -color_trc 6   -f hevc "$($_.Directory)\$($_.Basename).hvc"; 复制代码
<strong>题外话9</strong>
这两天在写QT的UI 等我弄差不多了 撸个图形界面出来

<strong>大型题外话</strong>
<strong>heic好在哪里?</strong>
在我们正式进入这个话题之前, 我们首先要知道图片这种东西, 大体上有两种储存形式:


<strong>位图和矢量图</strong>



这两者的区别主要在于图像的储存原理上, 图像中包含很多信息, 


在储存这些信息时, 位图将"图像"上的所有点, 向一个 X × Y 的高维矩阵进行映射, 每一个点包含了一组颜色信息 (这就是先前我们的提到的色彩空间),

一个像素点只能有一组色彩, 在极端情况下, 使用 1 × 1的矩阵对图像进行映射, 我们只能得到一个色块, 图像的信息就这么阵亡了.

这就是我们平常说的<strong>分辨率越高</strong> 图像<strong>能储存的信息越多</strong> (质量不一定越好).


而矢量图走的则是另一种风格, 矢量图不是用矩阵, 而是用数学公式, 通过"算式"来储存图像信息.

对于一个普通的圆, 位图用一圈像素来表示, 需要记载每一个点的所有信息, 而矢量图只需要一个公式就可以表示这个圆.

这样一来, 矢量图本身就没有分辨率的限制, 可以无限放大缩小, 非常美好.

然而在储存简单图片的时候矢量图很吊, 可一旦战场扩大到颜色复杂, 图形<strong>复杂的"照片"</strong>领域, 矢量图的<strong>体积就会爆发性的增长</strong>, 渲染难度也不断加大,

不管怎么说, 这都不是一个储存复杂图像的合理选择.

<strong>"压缩"</strong>


如果我们的目的是用尽可能少的空间来储存复杂图像的话, 基于上述原因, 首先就排除了矢量图.

重点就在于如何高效的储存位图信息上, 这里我举几个例子, 说说几个常见格式的做法.

<strong>古老的Bitmap(bmp)</strong>

1.拿出一张jpg, 打开你的matlab, 


2.读取这张jpg, 


3.得到了一个和每一个像素点一一对应的 x × y 的矩阵, 


4,把矩阵原封不动的储存起来.

好的, 你得到了一张bitmap. 在渲染图片的时候, 无论你采用什么格式来储存图像, 最终都会得到一个广义上的bitmap.

(最终显示在你的显示器上)


就格式而言, <strong>bmp不对矩阵进行任何压缩, 无损储存所有信息, 但也因此体积十分巨大.</strong>

<strong>土豪可以接触到的RAW</strong>

这个我没用过, 没具体研究过.

如果说bmp格式原封不动的储存了所有矩阵信息的话, 


那相机使用的RAW格式连各种传感器的数据都无损保存了.

这是一组原初的数据, 在数字图像领域, 这种元初就代表了最丰富的信息.
<strong>
</strong>
<strong>人人都在用的JPG</strong>

拿出你刚才储存的bitmap, 把图像分成n个8 × 8的像素块.

对像素块进行二位傅里叶展开, 得到一组频域的信息,

从左到右从上到下   依次排列   从低频到高频的分量的系数

<strong>去掉高频信息</strong>(把高频部分归零, 所以说jpg是天生有损的)

然后使用Z字编码对图像进行编码(因为高频都在右下角 所有压缩率很高).

这样你就得到了一个JPG.

表情包越传越绿就是因为<strong>高频信息在无数次压缩之中渐渐丢失了</strong>...

感兴趣的人推荐阅读:[https://www.freecodecamp.org/new ... 2316f35/#.y8yys5lh0](https://www.freecodecamp.org/news/how-jpg-works-a4dbd2316f35/#.y8yys5lh0)


<strong>PNG</strong>

这个格式是无损的

拿出你刚才的bitmap, 图像进行差分编码.

所谓差分编码, 是在说图像的储存过程中, 每一个像素的实际值, 都被转化为了通过周围像素的计算的一个式子.

哪一组 1 × n的像素条举例子:

1 2 3 4 5 6 9


第二个像素的值 可以写成  1+1

第三个像素的值 就是 第二个像素 +1


第七个像素的值 是第六个像素的+3

那么依据这个方式来储存上面的式子的话, 就可以写成:

1 1 1 1 1 1 3

这里面有很多的1, 电脑就没必要储存一堆1 只需要储存 "接下来的n个格子里都是1" 就可以了, 节省大量的空间.

<strong>GIF</strong>

没了解过

<strong>TIFF/TIF</strong>

十分灵活复杂的图像格式, 我所有的电子书扫图 (插图比较少的, 偏文字的, 都是使用tif储存的)

这个格式里面可以像heic一样加入各种图像数据, 


再用一些tag(tiff全名 tag image format file)来标记各种信息(色彩空间 压缩算法一类的)

它可以无损压缩, 也可以有损压缩, 
<strong>对于主打文字的轻小说的扫图而言,</strong>
<strong>使用tiff将图像变为黑白两色之后进行压缩, 可以制造出体积很小的高质量扫图.</strong>

<strong>Webp</strong>

现在谷歌主推的格式:

他是基于VP8视频标准的一种新型格式, 先不说背后的<strong>爸爸们体量</strong>多大, 仅从技术角度来讲,

WEBP博采众长, 说是<strong>第二强</strong>的图片格式也不为过.

首先webp(有损, webp的有损无损算法类似但是不一样)的核心技术是源自VP8的<strong>宏预测</strong>,

所谓宏观预测, 就是对图像进行4 × 4 的分块之后, <strong>基于左边和上边的格子, 对现在的格子进行推导</strong>.

webp会采用一系列推导方式, 并和原图的对应色块作比较, <strong>记录</strong>下来该区域采用的最终效果最好的"推导方式".(像不像png?)

在这个基础上, webp对色块还进行了jpg所用的取高频压缩处理.

最终实现了一个压缩能力顶尖的图像格式.


webp同时还有无损格式, 参见:[https://developers.google.com/sp ... tream_specification](https://developers.google.com/speed/webp/docs/webp_lossless_bitstream_specification)

<strong>Heic</strong>

Heic全称: High....emmm 好像是<strong>High Efficiency Image with hevC encoder </strong>


就像webp起源于vp8一样, heic也有个好爹, 即苹果的mov格式, 好像叫quick time format.

我之前提到过,<strong> heic是容器</strong> 容器内部可以套视频或者图片或者别的容器, 我就曾经给webp套过heic来尝试欺骗ios 不过这是后话了.

我们这里只讨论使用hevc编码, 采用heic容器封装的heic, 后面所有heic均指容器本身, hevc指图像编码方式.


Heic的结构其实很简单
<img src="https://pic4.zhimg.com/80/v2-1221190c851c7c6b0d220a0c76bd6db3_720w.jpg" referrerpolicy="no-referrer">

抛开储存信息的部分不谈, 重点是<strong>储存带时间的轴的视频moov部分</strong>和<strong>储存图像(或者序列, 类似gif那种一组图像)</strong><strong>的mdat</strong>部分.


苹果在heic格式 并不是单纯的将一张图片放入容器中的mdat部分,

而是对图像进行了<strong>再分割</strong>, 把所有小块储存在一个个mdat中, 和png等格式不同的是, heic这种组织结构并<strong>不是线性派生的</strong>.

从png获取图像你需要<strong>从原点出发依次推演, jpg你需要线性解码, webp你也需要推演</strong>,

但HEIC是<strong>支持多线程编码解码</strong>的, 如果你有GPU, 解码编码的速度还能进一步提升.

这就是说, 仅就<strong>读写性能</strong>而言, heic是当之无愧的<strong>最强</strong>图像格式.



但我只所以在这里介绍heic, 是为了节省大家的空间, 而不是获得最强的吞吐性能.

这种heic之所以可以在无损的情况下极大压缩空间, 还要得益于<strong>H265编码</strong>自身的优越性.


我之前说webp的压缩的时候提到了一种基于VP8的<strong>预测算法</strong>, hevc使用的预测方式和webp的方式类似.

硬要说有什么不同的话, 那就是webp倾向于用"一组 x × y"去预测另外一组 "x × y", 


而h265 h264都倾向于用 预测区域左上角两排像素来预测.


这种改变不会给图像体积带来多么大的压缩(其实已经很大了, 这里是和后面的对比), 


在高频信息特别丰富的情境下, <strong>想要尽可能保留原图质量, 这些预测的使用必然会受到限制</strong>.

就好像h264和webp一共就那么几个预测模式, 


如果都不合适, <strong>那就只能原封储存图像块</strong>, 仅仅进行类似png的压缩算法, 提高了储存所需要的空间.



下图是h264支持的预测模式

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503092555.jpg" referrerpolicy="no-referrer">

webo支持的预测模式如何

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503093327.jpg" referrerpolicy="no-referrer">



<strong>BANNER</strong>


<strong>H</strong>
<strong>2</strong>
<strong>6</strong>
<strong>5</strong>


<strong>支持的预测模式:</strong>

一共
34<strong>种</strong>!!!!

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503092629.jpg" referrerpolicy="no-referrer">


这就是为什么hevc编码能达到如此之高的压缩率, 通过使用高达34种预测模式, <strong>预测区域 和 原图 无损撞车的概率提高</strong>.

最终秒天秒地秒谷歌, 成为了<strong>最强的图像格式</strong>.<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503093920.png" referrerpolicy="no-referrer">


咕.. 解释完了<img src="https://static.saraba1st.com/image/smiley/face2017/033.png" referrerpolicy="no-referrer">(我在激动什么?


凭印象写的 可能有错误或者有过时的内容 还请大佬多多包涵 或者在回复区指出错误
从onedrive里找到了以前的标准文件 发上来感兴趣的可以看看....





<img alt="" border="0" class="vm" src="https://static.saraba1st.com/image/filetype/pdf.gif" referrerpolicy="no-referrer">



c066067_ISO_IEC_23008-12_2017.pdf


2020-5-3 10:00 上传
点击文件名下载附件




905.82 KB, 下载次数: 25


HEIC标准文件







﹍﹍﹍

评分





 参与人数 21战斗力 +27

|昵称|战斗力|理由|
|----|---|---|
| whzfjk| + 2|好评加鹅|
| fat| + 2|欢乐多|
| 风速前进mo| + 1|好评加鹅|
| Stellar_Frost| + 1|共产主义精神|
| hein| + 2|好评加鹅|
| Probe_tanji| + 1|好评加鹅|
| 史莱姆KING| + 2|好评加鹅|
| 水上由崎| + 1|好评加鹅|
| GrassSand| + 1|好评加鹅|
| yvev| + 1|好评加鹅|
| yst234| + 1|好评加鹅|
| ArtoriaPendrago| + 2|谢谢茄子|
| Sacko9| + 1|好评加鹅|
| 肆暮江飛鳥| + 1|好评加鹅|
| 酒神的狂欢祭| + 1|好评加鹅|
| Evomenon| + 1|好评加鹅|
| 尼特子很辛苦哟| + 1||
| haluka| + 1||
| 真田丸| + 1||
| xzhlj0325| + 2||



查看全部评分






*****

####  AkariHayasaka  
##### 2#       发表于 2020-5-2 11:21




还有这种操作。。感谢楼主。我珍藏的几千本本子有救了<img src="https://static.saraba1st.com/image/smiley/face2017/077.png" referrerpolicy="no-referrer">

[  -- 来自 能手机投票的 Stage1官方 Android客户端](https://www.coolapk.com/apk/140634)







*****

####  lbs123456  
##### 3#       发表于 2020-5-2 11:33




这……色彩空间变了吧 确定是无损吗？







*****

####  冰箱研会长  
##### 4#         楼主| 发表于 2020-5-2 11:42



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47277525&amp;ptid=1931974" target="_blank">lbs123456 发表于 2020-5-2 11:33</a>

这……色彩空间变了吧 确定是无损吗？</blockquote>
欸? 我没拿彩**片测试过...用的都是黑白漫画...

不过色彩空间就是个矩阵转换的事 "图像本身"(啊) 是没有损失的, 如果crt设置为0的话, 不过20左右应该是肉眼无损, 函数里面我设置的是, 1映射crt为10 0.1映射crt为19 大概是这样 具体数值忘了







*****

####  冰箱研会长  
##### 5#         楼主| 发表于 2020-5-2 11:45



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47277525&amp;ptid=1931974" target="_blank">lbs123456 发表于 2020-5-2 11:33</a>

这……色彩空间变了吧 确定是无损吗？</blockquote>
而且函数使用ffmpeg是用的是10位的色彩空间 一般srgb啥的我记得是8位的吧, 讲道理是可以无损的.



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| lbs123456| + 1|我回家刚准备试一下就看到主楼修正了 好评.|



查看全部评分






*****

####  真田丸  
##### 6#       发表于 2020-5-2 11:54




一个苹果用户专门写面向windows用户的压缩教程，这是一种什么样的精神啊



﹍﹍﹍

评分





 参与人数 1战斗力 -2

|昵称|战斗力|理由|
|----|---|---|
| xzhlj0325|-2|巨魔注意|



查看全部评分






*****

####  rrpw777  
##### 7#       发表于 2020-5-2 12:40




-x265-params lossless=1



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1||



查看全部评分






*****

####  菜姬  
##### 8#       发表于 2020-5-2 14:07



 本帖最后由 菜姬 于 2020-5-2 14:22 编辑 

刚想回复lossless 发现楼上已经回答过了







*****

####  冰箱研会长  
##### 9#         楼主| 发表于 2020-5-2 15:13




到现在我觉得算是完善的差不多了 不算之前改的 发出来之后我又改了七八回.

补充个对比图吧.

Webp的原图 使用题外话7的配置 参数为 0(相对最差 crt是11)

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502150323.jpg" referrerpolicy="no-referrer">

Heic文件夹大小

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502150350.jpg" referrerpolicy="no-referrer">

Webp文件夹大小


再来几张放大的细节对比图:

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502150905.jpg" referrerpolicy="no-referrer">


转换出来的heic封面

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502150956.jpg" referrerpolicy="no-referrer">


webp原图的封面


二者文件大小 heic:webp

500kb 2.05mb

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502151106.jpg" referrerpolicy="no-referrer">

一张科尔维特的车灯 heic格式

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502151135.jpg" referrerpolicy="no-referrer">

还是那个车灯 webp格式


二者体积对比

476kb 1385kb

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502151225.jpg" referrerpolicy="no-referrer">


488的车标 heic

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200502151248.jpg" referrerpolicy="no-referrer">


webp


大小对比:


433.19kb 1.67mb









*****

####  若荼泱  
##### 10#       发表于 2020-5-2 15:34




HEVC扩展可以来[这里](https://store.rg-adguard.net/)获取直链

比如上面那个：[x64](http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/00c98110-1fc1-480e-92a2-464d742a103b?P1=1588405437&amp;P2=402&amp;P3=2&amp;P4=kpHDNvVszlDbjkdsWVabUUAQBtLjBVCc0QbbvyX4tjYi6r2Hm42GoJhZNjsXg515%2fMQzC4PAndYxaijrfbumTQ%3d%3d)   [x86](http://tlu.dl.delivery.mp.microsoft.com/filestreamingservice/files/44d05c2f-b75b-4034-b52c-d07263b54a92?P1=1588405417&amp;P2=402&amp;P3=2&amp;P4=Z3nmvzGTvtSXKdGI49sjlB6sdDW8VXV1zHNeFewqDifDLSEqhtp4SMZOECF6Y5YVdBs5VYJpaDUj2sNPJs%2flyw%3d%3d)







*****

####  冰箱研会长  
##### 11#         楼主| 发表于 2020-5-2 15:41



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47279821&amp;ptid=1931974" target="_blank">若荼泱 发表于 2020-5-2 15:34</a>

HEVC扩展可以来这里获取直链

比如上面那个：x64   x86</blockquote>
这什么宝贝网站 藏了







*****

####  华蝶风雪  
##### 12#       发表于 2020-5-2 15:52



 本帖最后由 华蝶风雪 于 2020-5-2 15:54 编辑 

这种增减一像素在ffmpeg可以直接做
[https://ffmpeg.org/ffmpeg-all.html](https://ffmpeg.org/ffmpeg-all.html) 39.148 pad



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|我是惯用imagemagick ff实在是不熟悉.|



查看全部评分






*****

####  御坂MKII  
##### 13#       发表于 2020-5-2 15:57



<img src="https://static.saraba1st.com/image/smiley/face2017/075.png" referrerpolicy="no-referrer">码一个







*****

####  Aeroblast  
##### 14#       发表于 2020-5-2 16:03




ComicShare能用webp，从某漫画抓出来是webp，实在是懒得折腾了……


真无损的话，傻瓜化工具希望



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|可以等我写个qt UI出来 你可以看我楼上的对.|



查看全部评分






*****

####  冰箱研会长  
##### 15#         楼主| 发表于 2020-5-2 16:54



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47280106&amp;ptid=1931974" target="_blank">Aeroblast 发表于 2020-5-2 16:03</a>

ComicShare能用webp，从某漫画抓出来是webp，实在是懒得折腾了……


真无损的话，傻瓜化工具希望 ...</blockquote>
可以看眼楼上的对比图 2000%放大 像素块看不出差别 没拿滴管工具试 我待会直接传一个对比包 大家可以自己拿回去测试







*****

####  冰箱研会长  
##### 16#         楼主| 发表于 2020-5-2 16:56



[https://send.firefox.com/downloa ... d6HWT6US3INBIzNioTQ](https://send.firefox.com/download/c73c90bf36481dbd/#DY6d6HWT6US3INBIzNioTQ)


HEIC对比包 20次下载/7天之后报废 <img src="https://static.saraba1st.com/image/smiley/face2017/009.gif" referrerpolicy="no-referrer">







*****

####  肆暮江飛鳥  
##### 17#       发表于 2020-5-2 17:46



 本帖最后由 肆暮江飛鳥 于 2020-5-2 17:48 编辑 

楼主的方法对于我这种小白来说太麻烦了，希望楼主能做出一个软件来分享，感谢。

但小白有小白的方法，我用这个软件批量压缩，分辨率不变情况下有损压缩，压缩率挺高的，黑白漫画有损压缩清晰度对比不是特别明显。


<img src="https://img.saraba1st.com/forum/202005/02/174417egcncuuwm4m2ao2p.jpg" referrerpolicy="no-referrer">


<strong>批注 2020-05-02 174354.jpg</strong> (53.71 KB, 下载次数: 0)

下载附件

2020-5-2 17:44 上传







<img alt="" border="0" class="vm" src="https://static.saraba1st.com/image/filetype/binary.gif" referrerpolicy="no-referrer">

compress_1.5.0.0.exe
(1.51 MB, 下载次数: 34)



2020-5-2 17:42 上传

点击文件名下载附件










运行打不开的记得安装Microsoft Visual C++ 全家桶




﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|抽空做|



查看全部评分






*****

####  冰箱研会长  
##### 18#         楼主| 发表于 2020-5-2 18:16



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47279976&amp;ptid=1931974" target="_blank">华蝶风雪 发表于 2020-5-2 15:52</a>

这种增减一像素在ffmpeg可以直接做

https://ffmpeg.org/ffmpeg-all.html 39.148 pad</blockquote>
我仔细时间了一遍, 不需要imagemagick了 速度也提升了 但是问题在于imagemagick的增减像素是根据周围像素的 而ffmpeg只是固定颜色增加像素 而这里用的libx265有不支持透明像素的alpha通道. 唯一的选择就是不pad 而是crop 但是crop可是实实在在删掉了一层像素啊.


在libx265支持alpha之前, 还得用imagemagick做这个pad处理.







*****

####  元肉丸子  
##### 19#       发表于 2020-5-2 20:42




好贴马克

—— 来自 Xiaomi MIX 2S, Android 9上的 [S1Next-鹅版](https://github.com/ykrank/S1-Next/releases) v2.2.2.1







*****

####  azbhg1  
##### 20#       发表于 2020-5-2 20:42




好帖顶，虽然估计用不到







*****

####  loli炮  
##### 21#       发表于 2020-5-2 20:46




前段时间下了两部港漫 PDF格式的 十好几G  <img src="https://static.saraba1st.com/image/smiley/face2017/025.png" referrerpolicy="no-referrer">







*****

####  loli炮  
##### 22#       发表于 2020-5-2 23:50




哦对了 大佬有没有直接重压缩zip文件的办法(某些图片大的离谱了)  一个个倒腾挪到另一个盘解压在用压缩图软件过一遍 在重新打包搞几个就受不了了。 







*****

####  aji47  
##### 23#       发表于 2020-5-3 00:34



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47284927&amp;ptid=1931974" target="_blank">loli炮 发表于 2020-5-2 23:50</a>
哦对了 大佬有没有直接重压缩zip文件的办法(某些图片大的离谱了)  一个个倒腾挪到另一个盘解压在用压缩图软 ...</blockquote>
重新压缩的话 windows的好压有单独压缩
或者我这边有个简陋脚本

[https://github.com/hjyssg/ShiguR ... script-generator.js](https://github.com/hjyssg/ShiguReader/blob/dev/src/tools/script-generator.js)







*****

####  loli炮  
##### 24#       发表于 2020-5-3 01:23



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47285290&amp;ptid=1931974" target="_blank">aji47 发表于 2020-5-3 00:34</a>

重新压缩的话 windows的好压有单独压缩

或者我这边有个简陋脚本</blockquote>
怎么用！！！下下来个文件ShiguReader-dev不会用

哦我是火狐好像装不了 而且我说的功能可能复杂了些稍有些不同 不过还是谢谢了







*****

####  SmterC  
##### 25#       发表于 2020-5-3 02:13




之前还费了挺大功夫把收藏的漫画都转成webp格式的，不过确实webp还不够理想。
2k分辨率左右30页的本子，q75的webp也要80m左右，如果heic在安卓上支持的好的话就打算再全转成heic了。

—— 来自 OnePlus ONEPLUS A3000, Android 10上的 [S1Next-鹅版](https://github.com/ykrank/S1-Next/releases) v2.2.2.1







*****

####  aji47  
##### 26#       发表于 2020-5-3 02:28



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47285659&amp;ptid=1931974" target="_blank">loli炮 发表于 2020-5-3 01:23</a>
怎么用！！！下下来个文件ShiguReader-dev不会用

哦我是火狐好像装不了 而且我说的功能可能复杂了些稍有 ...</blockquote>
那是一个单独node脚本 和其他的代码完全无关 node 文件名就行了

诶，你还是安装好压好了







*****

####  冰箱研会长  
##### 27#         楼主| 发表于 2020-5-3 06:25



 本帖最后由 冰箱研会长 于 2020-5-3 06:29 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47283103&amp;ptid=1931974" target="_blank">loli炮 发表于 2020-5-2 20:46</a>

前段时间下了两部港漫 PDF格式的 十好几G</blockquote>
可以用 PDF补丁丁 拆开 然后处理一遍 但是PDF不支持插入heic 处理之后就只能用压缩包一类的管理 不过就凭heic这个压缩比 我现在已经不用压缩包了..







*****

####  冰箱研会长  
##### 28#         楼主| 发表于 2020-5-3 06:26



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47285924&amp;ptid=1931974" target="_blank">SmterC 发表于 2020-5-3 02:13</a>
之前还费了挺大功夫把收藏的漫画都转成webp格式的，不过确实webp还不够理想。
2k分辨率左右30页的本子，q75 ...</blockquote>
你可以试试 小米肯定是支持的 我记得发布会里面有讲过







*****

####  cxf5102  
##### 29#       发表于 2020-5-3 07:39




想法不错。不过你这是有多少图才需要这样折腾？我觉得不如直接买硬盘







*****

####  plusSharp  
##### 30#       发表于 2020-5-3 08:08




视频编码在压缩连续的多张差别极小的图片时很有效，但漫画里这种情况一般不多见吧，真出现这种情况一般都会被读者喷是在水页数







*****

####  冰箱研会长  
##### 31#         楼主| 发表于 2020-5-3 09:55



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47286475&amp;ptid=1931974" target="_blank">plusSharp 发表于 2020-5-3 08:08</a>

视频编码在压缩连续的多张差别极小的图片时很有效，但漫画里这种情况一般不多见吧，真出现这种情况一般都会 ...</blockquote>
你看眼我刚更新的 这里用的不是视频编码的帧对比技术 是同帧内的分块压缩







*****

####  冰箱研会长  
##### 32#         楼主| 发表于 2020-5-3 09:55



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47285978&amp;ptid=1931974" target="_blank">aji47 发表于 2020-5-3 02:28</a>

那是一个单独node脚本 和其他的代码完全无关 node 文件名就行了


诶，你还是安装好压好了 ...</blockquote>
咕 我写完介绍部分了....







*****

####  alien  
##### 33#       发表于 2020-5-3 15:48



 本帖最后由 alien 于 2020-5-3 15:51 编辑 

作为技术小白和懒人，偶尔也扫扫图的人，想要的是

1、一键安装包含所有必须插件的图形界面的图片转换程序。主楼的软件链接能安的都安了 ffmpeg那个不知怎么安装~ 然后官方下载下来的好像是appx安装文件那个要win10吧~办公室电脑win7~

2、最好是有photoshop也能用的转换存储插件，修图存储一步到位。

3、推荐能阅读zip rar压缩包中的heic格式的看漫画软件，上面XnView我看不了压缩包里的图片~随手搜了下好像没办法看？~~~~毕竟习惯一个包一本漫画的形式，只能散放在文件夹里面看不方便

qq浏览器能看lz的heic但解析不正确~有条纹~ 安装不了appx

如果有插件安装后什么看图软件都能看的最好~不用更换软件~（这个是奢望吧~）







*****

####  水上由崎  
##### 34#       发表于 2020-5-3 15:55




好评加鹅

不断jpg压缩到最后应该会变成高斯模糊……越来越绿是因为每次上传百度贴吧会加上一层绿色的滤镜……







*****

####  冰箱研会长  
##### 35#         楼主| 发表于 2020-5-3 16:45



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47289529&amp;ptid=1931974" target="_blank">alien 发表于 2020-5-3 15:48</a>

作为技术小白和懒人，偶尔也扫扫图的人，想要的是

1、一键安装包含所有必须插件的图形界面的图片转换程序。 ...</blockquote>
ios上面我知道一个里世界阅读器可以透zip阅读heic 我用的就是这个

ffmpeg不应该啊...

你确定你下载的是这个?
<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200503164544.jpg" referrerpolicy="no-referrer">

我这都是exe啊







*****

####  Probe_tanji  
##### 36#       发表于 2020-5-3 18:14




拯救硬盘！科普好评 马克

—— 来自 OnePlus ONEPLUS A6000, Android 10上的 [S1Next-鹅版](https://github.com/ykrank/S1-Next/releases) v2.2.2.1







*****

####  lwa190212  
##### 37#       发表于 2020-5-3 18:41



 本帖最后由 lwa190212 于 2020-5-3 18:43 编辑 

我觉得如果有自动去除印刷时加入的那种模拟灰色的点阵图案的话可以极大减少高频信息量

可惜我一直没有找到合适的算法支持

webp没有单灰度模式，我试过有的情况还不如灰度jpg压缩率高，喷了







*****

####  冰箱研会长  
##### 38#         楼主| 发表于 2020-5-3 19:38



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47291010&amp;ptid=1931974" target="_blank">lwa190212 发表于 2020-5-3 18:41</a>

我觉得如果有自动去除印刷时加入的那种模拟灰色的点阵图案的话可以极大减少高频信息量

可惜我一直没有找到 ...</blockquote>
jpg清洗高频很快的啊 不过为啥要去掉网点呢?







*****

####  山药白薯  
##### 39#       发表于 2020-5-3 20:10




啊这个贴让我想起来 刚看论坛怎么DVDISO压到AVI的那时候的教程了







*****

####  lwa190212  
##### 40#       发表于 2020-5-3 20:16



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47291602&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-3 19:38</a>

jpg清洗高频很快的啊 不过为啥要去掉网点呢?</blockquote>
网点通常用来模拟特定的灰度，换成灰度也不会造成观感上的差异

然后网点会在扫描的时候因为采样率问题出现更不规则的信息

总之网点代表的是一种从我的观感来说去掉也不影响画面的一类高频(带一些中频)信息，而且能去掉的话在某些扫描质量不是很好的漫画中达到非常高的压缩率而不损失其他画质，用jpg压高频会把有价值的信息也破坏掉

我尝试过能用webp的q85压到jpg的30%容量的图，用ps去掉网点后再用q85能达到10%以内，相当于再压缩到之前的webp的1/3以内







*****

####  冰箱研会长  
##### 41#         楼主| 发表于 2020-5-3 20:44



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47292056&amp;ptid=1931974" target="_blank">lwa190212 发表于 2020-5-3 20:16</a>

网点通常用来模拟特定的灰度，换成灰度也不会造成观感上的差异

然后网点会在扫描的时候因为采样率问题出 ...</blockquote>
哈哈哈 咱俩看法不太一样, 我是绝对不能忍受网点丢失的. 要是网点丢失了就会觉得 "啊, 我在看被压缩过的漫画了" 贼难受.

不过你说的这个想法 我第一时间想到是做一个高斯模糊, Imagemagick 有进行高斯模糊的参数 你可以顺着这个关键词找找看







*****

####  lwa190212  
##### 42#       发表于 2020-5-3 20:51



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47292384&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-3 20:44</a>

哈哈哈 咱俩看法不太一样, 我是绝对不能忍受网点丢失的. 要是网点丢失了就会觉得 "啊, 我在看被压缩过的 ...</blockquote>
常见的卷积相关的算法我都试过了，频率域的处理也试过一些，结果上说都不理想

网点小的话在屏幕上看，遇到没有摩尔纹处理的缩放算法就直接没法看了，用了去摩尔纹的滤镜都会糊一些

自己处理网点可以做到画面清晰锐利，应该是不会有常见的jpg高压过的图片的那种感觉的，不过精力代价是不可接受的了<img src="https://static.saraba1st.com/image/smiley/face2017/068.png" referrerpolicy="no-referrer">







*****

####  hac0101  
##### 43#       发表于 2020-5-3 20:59




扫描出来的图

黑白漫画的网点属于正常的网点，一般要保留。

彩色·图片的网点属于墨点，一般要模糊处理吧。<img src="https://static.saraba1st.com/image/smiley/face2017/029.png" referrerpolicy="no-referrer">







*****

####  echoIII  
##### 44#       发表于 2020-5-3 22:33




可能不太会用PowerShell，我配完运行啥错都没报，但就是没反应。

自己敲命令试了一下，-crf 11的时候比webp还大，30的时候确实只有30%大小，但是画质已经肉眼可见的明显劣化了。

能否提供一些漫画对比的例子。







*****

####  凤舞夜月  
##### 45#       发表于 2020-5-3 22:40




太复杂了。。。作为渣渣只能等一个傻瓜化工具到手，再慢慢整理，然后老习惯打包成ZIP了。。。







*****

####  plusSharp  
##### 46#       发表于 2020-5-3 23:05



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47287007&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-3 09:55</a>
你看眼我刚更新的 这里用的不是视频编码的帧对比技术 是同帧内的分块压缩 ...</blockquote>
我看了一下不过完全不懂，这里的预测是指图像相邻的像素之间有很大的可能颜色相同吗？







*****

####  萼绿华  
##### 47#       发表于 2020-5-3 23:12




这倒提醒了我，是不是可以考虑将大量图片视为一个视频的不同帧进行进一步的压缩？这样还可以进一步利用多张图片之间的连续性。







*****

####  borrowface  
##### 48#       发表于 2020-5-3 23:44




楼主牛逼







*****

####  wangh  
##### 49#       发表于 2020-5-4 00:49




如果主要是日式黑白漫画的话就没必要这么复杂……

综合效率和兼容性最好的压缩方法是16级灰度的PNG格式。黑白漫画里灰度过渡一般是由网点构成的，所以从256级灰度减少到16级对画面的影响非常小，变成4位色后对于PNG压缩也变得更加有利。这样既能够完美保留所以的网点和线条等高频细节，而且也不会像其它有损压缩那样引入量化造成的噪音

以eh的本子为例，3000高度的扫图漫画，一页在1MB左右，1500高度的电子版漫画，一页300KB左右



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| lwa190212| + 1|好思路学习了|



查看全部评分






*****

####  琉璃苑軒風  
##### 50#       发表于 2020-5-4 01:15



<img src="https://static.saraba1st.com/image/smiley/face2017/003.png" referrerpolicy="no-referrer">虽然看不明白但是感觉可以学一下

—— 来自 HUAWEI LYA-AL00, Android 10上的 [S1Next-鹅版](https://github.com/ykrank/S1-Next/releases) v2.1.0-play







*****

####  lwa190212  
##### 51#       发表于 2020-5-4 01:17




毕竟上次折腾已经隔了很久了，刚又去搜索了下关于这个网点的算法，发现已经有机器学习的方法了
[Inverse Halftoning Through Structure-Aware Deep Convolutional Neural Networks](https://arxiv.org/abs/1905.00637)


而且很早以前也有非机器学习的传统算法，不知道为何以前没有找到，明明搜的关键词都是halftone inverse<img src="https://static.saraba1st.com/image/smiley/face2017/044.png" referrerpolicy="no-referrer">
[http://www.cse.cuhk.edu.hk/~leoj ... lts_dehalftone.html](http://www.cse.cuhk.edu.hk/~leojia/projects/rollguidance/results_dehalftone.html)


不过我觉得ls用低bit保留网点的思路也很不错，学习了







*****

####  SkywalkerJi  
##### 52#       发表于 2020-5-4 01:51




但是HEIC兼容性不如WEBP吧，除了苹果自家软硬件强行不支持webp，heic基本就苹果还在主导，大多数web漫画格式本身都是webp了。

楼主的对比两者都是基于有损压缩算法吗？如果使用无损算法HEVC对比VP8L的情况会如何。


不过现在都是TB级存储，漫画这点空间还是无损优先吧。







*****

####  冰箱研会长  
##### 53#         楼主| 发表于 2020-5-4 07:55



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47293505&amp;ptid=1931974" target="_blank">echoIII 发表于 2020-5-3 22:33</a>

可能不太会用PowerShell，我配完运行啥错都没报，但就是没反应。

自己敲命令试了一下，-crf 11的时候比webp ...</blockquote>
没反应 不应该啊 函数一共四个参数 一个路径 加双引号 \一个质量 0到1 \ 一个原格式 webp或者其他什么东西 不加点\一个目标格式 heic或者其他什么东西 也不加点

对比图我待会找找







*****

####  冰箱研会长  
##### 54#         楼主| 发表于 2020-5-4 07:59



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47295088&amp;ptid=1931974" target="_blank">SkywalkerJi 发表于 2020-5-4 01:51</a>

但是HEIC兼容性不如WEBP吧，除了苹果自家软硬件强行不支持webp，heic基本就苹果还在主导，大多数web漫画格 ...</blockquote>
兼容性问题也就那样吧 关于对比我待会统一搞个对比出来







*****

####  YoumuChan  
##### 55#       发表于 2020-5-4 09:27



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47292457&amp;ptid=1931974" target="_blank">lwa190212 发表于 2020-5-3 20:51</a>

常见的卷积相关的算法我都试过了，频率域的处理也试过一些，结果上说都不理想

网点小的话在屏幕上看，遇 ...</blockquote>
我记得我以前处理扫描时的摩尔纹是在gimp上fft以后抹平四周的高频spike再fft回来

但是网格第一不是全图的纹理，其次不是方的，最后在频域上可能兼有高频和低频信号，而且最后要追求的是把区域换成网格区域的平均灰度，感觉选取网格区直接计算灰度总和再平均是不是比较合适

所以问题其实是如何检测并分类一张图的网格区域，一个想法是检测每个像素是否可能是某个网格的中心，然后再floodfill，不过感觉效率有点低







*****

####  冰箱研会长  
##### 56#         楼主| 发表于 2020-5-4 09:50



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47293505&amp;ptid=1931974" target="_blank">echoIII 发表于 2020-5-3 22:33</a>

可能不太会用PowerShell，我配完运行啥错都没报，但就是没反应。

自己敲命令试了一下，-crf 11的时候比webp ...</blockquote>
我放了一组对比 我处理200张异世界叔叔扫图 crf0的时候就有5%左右的压缩 10的时候已经只有一半大了 这时候我在2000%放大模式下很难找到劣化. crt20的时候压缩到了1/4 低频区丢失了一些信息 然而高频纹理都得到了保留 crf30的时候已经只有十分之一大小了. 与其同时webp无损到85%都要比原图还大 45%的时候和crf20体积差不多 效果也差不多.







*****

####  冰箱研会长  
##### 57#         楼主| 发表于 2020-5-4 09:51



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47295088&amp;ptid=1931974" target="_blank">SkywalkerJi 发表于 2020-5-4 01:51</a>

但是HEIC兼容性不如WEBP吧，除了苹果自家软硬件强行不支持webp，heic基本就苹果还在主导，大多数web漫画格 ...</blockquote>
我放了对比图 无损hevc体积减少5% vp8反而上升了10%左右...







*****

####  冰箱研会长  
##### 58#         楼主| 发表于 2020-5-4 09:53



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47293821&amp;ptid=1931974" target="_blank">plusSharp 发表于 2020-5-3 23:05</a>

我看了一下不过完全不懂，这里的预测是指图像相邻的像素之间有很大的可能颜色相同吗？ ...</blockquote>
是的 因为图片本身不是色块很多吗 这里就先预设几组公式 用周围的像素来计算压缩区域的像素.


然后我们就不需要记载像素的具体信息 只需要记载 "用什么样的公式能计算出效果最好的像素"就可以了








*****

####  lwa190212  
##### 59#       发表于 2020-5-4 09:55



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47296187&amp;ptid=1931974" target="_blank">YoumuChan 发表于 2020-5-4 09:27</a>

我记得我以前处理扫描时的摩尔纹是在gimp上fft以后抹平四周的高频spike再fft回来

但是网格第一不是全图的 ...</blockquote>
网格的fft特征还挺明显的，就下面图中除了中央以外的那几个亮点显然都是，毕竟一般的图片很少会在这种地方有这么高的能量
<img src="https://p.sda1.dev/0/c75069250b7520becd31a0fb079b49a4/chrome_2020-05-04_09-46-08.jpg" referrerpolicy="no-referrer">

不过我对频域上如何做到平滑地抹去这些能量没有经验，粗暴地抹除虽然能去掉大部分的网点，但也会增加不少其他的劣化，以及ifft回去后数值变化了好几个数量级，那还得量化到256级和修正对比度到与原图没有视觉上的偏差就很麻烦<img src="https://static.saraba1st.com/image/smiley/face2017/068.png" referrerpolicy="no-referrer">

不过见我51L，其实还有一些现成的算法可以用，我等有精力折腾的时候再试试了



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|好评加鹅|



查看全部评分






*****

####  plusSharp  
##### 60#       发表于 2020-5-4 11:44



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47296360&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-4 09:53</a>
是的 因为图片本身不是色块很多吗 这里就先预设几组公式 用周围的像素来计算压缩区域的像素.


然后我们就 ...</blockquote>
我今天又查了一下png相关资料，其中提到png使用lz77压缩，我不明白为什么不使用Huffman 编码，因为一般来说图片中不同颜色出现的频率相差很大，很适合用Huffman







*****

####  YoumuChan  
##### 61#       发表于 2020-5-4 11:49



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47296383&amp;ptid=1931974" target="_blank">lwa190212 发表于 2020-5-4 09:55</a>

网格的fft特征还挺明显的，就下面图中除了中央以外的那几个亮点显然都是，毕竟一般的图片很少会在这种地 ...</blockquote>
主要是我觉得网纹in general是比漫画要难很多的...所以在考虑一些没那么general的传统算法







*****

####  echoIII  
##### 62#       发表于 2020-5-4 16:18



 本帖最后由 echoIII 于 2020-5-4 16:21 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47296343&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-4 09:50</a>

我放了一组对比 我处理200张异世界叔叔扫图 crf0的时候就有5%左右的压缩 10的时候已经只有一半大了 这时 ...</blockquote>
我是拿日站DL版来测试的。

正版的扫图本身已经处理得很小，一本1200纵的大概在40MB左右，可以说它是优化容量，也可以说它是劣化质量（相比之下，个人扫图一般要大一倍以上），但是目前最容易获得的就是DL版（买了电子书DeDRM即可，钱空网盘里现在大量的都是DL版）。

漫画现在也是TB数量级，减小容量是有必要的，jpeg这种上古格式确实该丢到垃圾堆里。新格式里webp目前大致已普及，所以我之前的都压成webp了，webp（有损）质量值100的情况下体积大概是jpeg的60%，这时候来回切换比较，肉眼看不到区别。heic毕竟吃亏在支持软件少，如果没有显著优于webp的质量体积比还是没有洗的动力。


另外heic在win10下可以用传家宝MangaMeeya，安装SusiePlugin
[https://github.com/gameclamp/MangaMeeyaAssociations](https://github.com/gameclamp/MangaMeeyaAssociations)

能调用WindowsCodecs.dll来解码，然后安装了首帖上说的heic的两个解码器就能看了。

MM虽然死了n年，但作为漫画阅读软件，还是远胜单纯的看图软件。

iOS我给Comicshare写信提要求了，大家可以也去提，Comicshare更新勤快还是挺有可能支持的，毕竟很早就支持webp，这点比comicglass强。



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|好评加鹅|



查看全部评分






*****

####  冰箱研会长  
##### 63#         楼主| 发表于 2020-5-4 17:43



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47299645&amp;ptid=1931974" target="_blank">echoIII 发表于 2020-5-4 16:18</a>

我是拿日站DL版来测试的。

正版的扫图本身已经处理得很小，一本1200纵的大概在40MB左右，可以说它是优化容 ...</blockquote>
我给好多ios开发者发过邮件...除非我夸他们 不然他们都不回复我....

dl版啊 说起来我之前买了三本"剑世界2.5" 看都没看就转成heic了 现在也许可以拿来对比一试.







*****

####  yguygyu  
##### 64#       发表于 2020-5-4 18:12



 本帖最后由 yguygyu 于 2020-5-4 18:29 编辑 

我心想你一个 -pix_fmt yuv420p，uv 平面都半采样了，谈什么无损压缩啊。

无损怎么说也至少 yuv444 搞上啊。


视频压制组不用 yuv444 是因为拿到的片源就是 yuv420，本身就是半采样之后的，而很多时候在做预处理的时，都没有做必须保留 uv 平面拉伸后的分辨率的处理。

但是你漫画的图源如果是扫图或者是 png，bmp 的话，很有可能依旧保有原有的 uv 信息。

在这里用 yuv420 的话，就把 uv 平面的信息丢掉 3/4 了。








*****

####  冰箱研会长  
##### 65#         楼主| 发表于 2020-5-4 18:35



 本帖最后由 冰箱研会长 于 2020-5-4 19:26 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47300632&amp;ptid=1931974" target="_blank">yguygyu 发表于 2020-5-4 18:12</a>

我心想你一个 -pix_fmt yuv420p，uv 平面都半采样了，谈什么无损压缩啊。

无损怎么说也至少 yuv444 搞上啊 ...</blockquote>
啊啊啊啊啊啊啊啊啊啊

这里是我的锅

一路420用过来了 这里没注意到 我待会设置好参数之后换成444写到主楼里



草 试了一下 我手头唯一能越读全YUV采样的heic的只有IOS.....

事实上就连10bit的420我都仅仅找到xnview这一家支持的...

在编码heic这件事上, 可以用444, 但问题就是兼容性爆炸<img src="https://static.saraba1st.com/image/smiley/face2017/001.png" referrerpolicy="no-referrer">


不过反正是黑白图片 没关系的


(md 想把三楼回复合并到一楼里 才想起来s1不能删自己的楼...)








*****

####  冰箱研会长  
##### 66#         楼主| 发表于 2020-5-4 18:47



 本帖最后由 冰箱研会长 于 2020-5-4 19:26 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47300632&amp;ptid=1931974" target="_blank">yguygyu 发表于 2020-5-4 18:12</a>

我心想你一个 -pix_fmt yuv420p，uv 平面都半采样了，谈什么无损压缩啊。

无损怎么说也至少 yuv444 搞上啊 ...</blockquote>%合并到了上个回复%







*****

####  冰箱研会长  
##### 67#         楼主| 发表于 2020-5-4 18:48



 本帖最后由 冰箱研会长 于 2020-5-4 19:26 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47300632&amp;ptid=1931974" target="_blank">yguygyu 发表于 2020-5-4 18:12</a>

我心想你一个 -pix_fmt yuv420p，uv 平面都半采样了，谈什么无损压缩啊。

无损怎么说也至少 yuv444 搞上啊 ...</blockquote>
%合并到了上上个回复%







*****

####  御坂MKII  
##### 68#       发表于 2020-5-4 22:23



<img src="https://static.saraba1st.com/image/smiley/face2017/068.png" referrerpolicy="no-referrer">草 444采样现在windows现在还有这么多兼容性问题么，另一个人是mac全家桶，但是我自己主要用windows还有onedrive，难受了







*****

####  SkywalkerJi  
##### 69#       发表于 2020-5-5 00:09



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47296349&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-4 09:51</a>

我放了对比图 无损hevc体积减少5% vp8反而上升了10%左右...</blockquote>
感谢测试。

你是用JPG原图再压缩WEBP的吗？

用扫描仪直出的TIFF、bmp压缩会有区别么。这一次压缩感觉比PNG/jpg二压更重要。







*****

####  echoIII  
##### 70#       发表于 2020-5-5 00:28



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47295739&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-4 07:55</a>

没反应 不应该啊 函数一共四个参数 一个路径 加双引号 \一个质量 0到1 \ 一个原格式 webp或者其他什么东 ...</blockquote>
你改一下帖子里的“用法如下


在powershell中输入

imgconv "图片所在的目标文件夹" .原图格式 .目标格式”

丢了个参数。。

难怪我运行了没反应



我找了本漫画测了一下

37M     origin（jpeg 90%）

27M     jpeg（jpeg 80%）

22M     webp（80%）

32M     heic_crf10

18M     heic_crf20

8.5M    heic_crf30

91M     png（拿jpeg转的，仅作为体积的参考）


用氪金狗眼比对了一下

heic_crf20跟webp80%大致持平，

在400%下相比原始看不到明显劣化

应该说相比原始图片像素点都有变化，但是黑白漫画区别很小，一些像素点的变化甚至不好说是好是坏，总体感觉没有明显劣化

在彩页封面上，heic_crf20优于webp80%


即便是heic_crf30，在100%下都看不出明显劣化，但是200%就能明显看出

总的来说heic优于webp大概没问题，但我觉得差距在20~30%左右。

另外heic会有1个像素的偏移，可能会逼死强迫症<img src="https://static.saraba1st.com/image/smiley/face2017/068.png" referrerpolicy="no-referrer">


真要用来压制漫画的话，黑白漫画可以用更激进的参数，但是考虑到一般都是黑白彩色混杂懒得去判别，所以综合考虑的话crf20左右较为适合







*****

####  冰箱研会长  
##### 71#         楼主| 发表于 2020-5-5 06:50



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47304826&amp;ptid=1931974" target="_blank">SkywalkerJi 发表于 2020-5-5 00:09</a>

感谢测试。

你是用JPG原图再压缩WEBP的吗？

用扫描仪直出的TIFF、bmp压缩会有区别么。这一次压缩感觉比PN ...</blockquote>
实不相瞒 我现在手头一份tiff都没有了... 最多从jpg转出tiff 你要是有直接出的tiff 可以提供一份







*****

####  冰箱研会长  
##### 72#         楼主| 发表于 2020-5-5 07:00



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47305005&amp;ptid=1931974" target="_blank">echoIII 发表于 2020-5-5 00:28</a>

你改一下帖子里的“用法如下


在powershell中输入</blockquote>
嗯 感谢debug....

顺便这个一个像素偏移主要是因为采用了420采样, yuv空间的采样除了444以外都是隔行进行的. 我甚至怀疑yuv444在逻辑上也是隔行的, 虽然在数据上是1对1采样, 但是实际操作中估计还是不允许输入奇数大小的图像.

遇到奇数大小只能剪裁或者铺一层像素


这里用的两个函数 imgconv fimgconv 前者用其他软件增加一个像素  后者直接在原图上去掉一列像素.

前者对大小的修改是预处理 后者则是流式的 所以fimgconv快很多. 漫画这种一边都有页边距, 直接删一列像素就可了. 


你webp用什么编码的? 我用的Imagemagick 85%体积都会增加....







*****

####  V5Style  
##### 73#       发表于 2020-5-5 09:09




国区Microsoft Store是有HEVC插件的，只是搜索不到，通常会在安装驱动程序后自动安装
[https://www.microsoft.com/zh-cn/ ... cturer/9n4wgh0z6vhq](https://www.microsoft.com/zh-cn/p/hevc-video-extensions-from-device-manufacturer/9n4wgh0z6vhq)



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1||



查看全部评分






*****

####  yguygyu  
##### 74#       发表于 2020-5-5 18:58



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47300824&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-4 18:35</a>

啊啊啊啊啊啊啊啊啊啊

这里是我的锅

一路420用过来了 这里没注意到 我待会设置好参数之后换成444写到主楼 ...</blockquote>
黑白图片的话理论上可以直接舍弃掉 uv 信息直接编码个 Y800 出来，HEVC 编码也是支持的

只存了 luminance 信息，体积更小

ffmpeg 的选项应该是 -pix_fmt gray

只不过估计兼容性也是爆炸，没几个软件能解码



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1||



查看全部评分






*****

####  有口皆悲  
##### 75#       发表于 2020-5-5 20:46



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47306564&amp;ptid=1931974" target="_blank">V5Style 发表于 2020-5-5 09:09</a>

国区Microsoft Store是有HEVC插件的，只是搜索不到，通常会在安装驱动程序后自动安装

https://www.microsof ...</blockquote>
安装前还要先把系统设置里的区域切换成美国。。







*****

####  SmterC  
##### 76#       发表于 2020-5-5 21:38




试了一下，安卓上用的本地漫画软件comic screen支持webp但不支持heic。毕竟webp是谷歌亲儿子吧，大部分安卓应用下webp都没有兼容问题。

|不知道有没有支持heic的漫画软件推荐……我这里也提供一下我之前写的一个Python小脚本，用来批量转换漫画到webp格式的，也算是安卓用户暂时的替代方案吧。毕竟是自用的，代码水平臭还请轻拍。 import subprocess, multiprocessing, time, locale, time, os.path, os, re from PIL import Image   def get_filename(path):     name = []     filetypes = ['jpg', 'png', 'JPG', 'PNG', 'jpeg', 'JPEG']     for root, dirs, files in os.walk(path):         for file in files:             if True in [filetype in file for filetype in filetypes]:                 wholePath = os.path.join(root, file)                 name.append(wholePath)     print('找到%d个可以转换的图片' % len(name))     return name   def ruuun(kksk):     p = subprocess.Popen(kksk)     p.wait()     # print(kksk)   if __name__ == '__main__':     print('    _      __      __    ___    __  ___                      ')     print('   | | /| / /___  / /   / _ \  /  |/  /___ _ ___  ___ _ ___ _')     print('   | |/ |/ // -_)/ _ \ / ___/ / /|_/ // _ `// _ \/ _ `// _ `/')     print('   |__/|__/ \__//_.__//_/    /_/  /_/ \_,_//_//_/\_, / \_,_/ ')     print('                                                /___/        \t ver 2.0')      path = input('输入想要遍历的文件夹:(默认空)')     # filetype = input('想要转换的图片格式(png、jpg,默认jpg):')     loss = input('是否无损压缩？\n\t输入任意值无损\t默认有损:')     q = input('转换质量(0~100，默认85):')     pre = input('输入图片类型\n\t漫画为0，照片为1，人像为2，默认为漫画:')     limit = input('有无希望图片压缩达到的大小限制？以kb为单位:')     resize = input('图片的尺寸限制?:')     # wait = input('每4个任务后的等待时间:')     startFlag = input('开始执行(y/n):')     if path.strip() == '':         path = './'     # if filetype.strip() == '':     #     filetype = 'jpg'     if q.strip() == '':         q = '85'     q = '-q ' + q     if loss.strip() != '':         loss = '-lossless'         q = ''         # wait = 5     if pre.strip() == '':         preset = 'drawing'     if pre.strip() == '0':         preset = 'drawing'     if pre.strip() == '1':         preset = 'photo'     if pre.strip() == '2':         preset = 'picture'     if limit.strip():         li = eval(limit) * 1000         limit = '-size %d -pass 10' % li     if limit.strip() == '':         limit = ''     if resize.strip() == '':         resize = False     else:         resize = True     # if wait.strip() == '':     #     wait = '4'     if not startFlag.lower() == 'y':         print('执行终止')         exit()     files = get_filename(path)     # slc = 0      pool = multiprocessing.Pool(8)      for file in files:         pos = file.rfind("\")         os.makedirs(os.path.join('./result/', file[:pos]), exist_ok=True)         resultpath = file.replace(re.findall('\.[a-zA-z]+', file)[-1], '.webp')         existVerify = os.path.exists('./result/' + resultpath)         if existVerify:             zerobitVerif = os.path.getsize('./result/' + resultpath)             if zerobitVerif != 0:                 continue         resize_config = ''         if resize:             img = Image.open(file)             img_size = img.size             if (img_size[0] &gt; 1080 and img_size[1] &gt; 1920) or (img_size[1] &gt; 1080 and img_size[0] &gt; 1920):                 beishu = max(round(img_size[0] / 1080), round(img_size[0] / 1920))                 resize_config = "-resize %s %s" % (img_size[0] / beishu, img_size[1] / beishu)         kksk = 'cwebp -preset %s %s %s "%s" -m 6 %s -sharp_yuv -metadata all %s -short -af -mt -o "./result/%s"' % (             preset, loss, q, file, limit, resize_config, resultpath)          # print(kksk)         pool.apply_async(func=ruuun, args=(kksk,))          # slc = slc + 1         # if slc == 4:         #     time.sleep(int(wait))         #     slc = 0     pool.close()     pool.join()      print('全部完成,一共转换了%d张图片' % len(files))      exit = input('ds') 复制代码这段代码本质就是调用环境变量里的cwebp编码器来转换遍历文件到result文件夹，所以需要先从Google开发者官网下载个webptools放环境变量里。|

因为之前用Honeyview自带的格式转换转换到webp，发现结果和官方提供的最新编码器还是有点差距的，所以还是建议去下个最新的编码器来压缩比较好。

代码写的烂，所以只能遍历这个py文件同级或以下的目录，建议放到漫画根目录。




<img alt="" border="0" class="vm" src="https://static.saraba1st.com/image/filetype/unknown.gif" referrerpolicy="no-referrer">



webpmanga.py


2020-5-5 21:37 上传
点击文件名下载附件




3.83 KB, 下载次数: 2









﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1|好评加鹅|



查看全部评分






*****

####  V5Style  
##### 77#       发表于 2020-5-5 21:42



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47313060&amp;ptid=1931974" target="_blank">有口皆悲 发表于 2020-5-5 20:46</a>

安装前还要先把系统设置里的区域切换成美国。。</blockquote>
不需要吧，我这边就可以直接装
<[img src="https://i.loli.net/2020/05/05/iJtADCvU7NGMxgy.png" referrerpolicy="no-referrer">







*****

####  有口皆悲  
##### 78#       发表于 2020-5-5 21:59



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47313790&amp;ptid=1931974" target="_blank">V5Style 发表于 2020-5-5 21:42</a>
不需要吧，我这边就可以直接装</blockquote>
可能你之前已经购买过了吧。我不改区域点按钮没反应。







*****

####  V5Style  
##### 79#       发表于 2020-5-5 23:48



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47314036&amp;ptid=1931974" target="_blank">有口皆悲 发表于 2020-5-5 21:59</a>
可能你之前已经购买过了吧。我不改区域点按钮没反应。</blockquote>
多点几次试试，巨硬商店就是这样的，经常抽风<img src="https://static.saraba1st.com/image/smiley/face2017/067.png" referrerpolicy="no-referrer">
另外这个是装了DCH版核显驱动后自动下载，直接加进账户里的，没有手动下载过

—— 来自 HUAWEI NXT-TL00, Android 8.0.0上的 [S1Next-鹅版](https://github.com/ykrank/S1-Next/releases) v2.2.2







*****

####  lwa190212  
##### 80#       发表于 2020-5-6 03:32



 本帖最后由 lwa190212 于 2020-5-6 03:36 编辑 
<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47306121&amp;ptid=1931974" target="_blank">冰箱研会长 发表于 2020-5-5 07:00</a>

嗯 感谢debug....

顺便这个一个像素偏移主要是因为采用了420采样, yuv空间的采样除了444以外都是隔行进行 ...</blockquote>
yuv444可以奇数输入：
 <blockquote>ffmpeg -i "R:\_\0.bmp" -y -c libx265 -x265-params lossless=1 -pix_fmt yuv444p -f hevc "R:\_\0.hvc"

Input #0, bmp_pipe, from 'R:\_\0.bmp':

  Duration: N/A, bitrate: N/A

    Stream #0:0: Video: bmp, bgr24, 799x501, 25 tbr, 25 tbn, 25 tbc

Stream mapping:

  Stream #0:0 -&gt; #0:0 (bmp (native) -&gt; hevc (libx265))

Press [q] to stop, [?] for help

x265 [info]: HEVC encoder version 3.2+6-f46aa2bc1c34

x265 [info]: build info [Windows][GCC 9.2.1][64 bit] 8bit+10bit

x265 [info]: using cpu capabilities: MMX2 SSE2Fast LZCNT SSSE3 SSE4.2 AVX FMA3 BMI2 AVX2

x265 [warning]: halving the quality when psy-rd is enabled for 444 input. Setting cbQpOffset = 6 and crQpOffset = 6

x265 [info]: Main 4:4:4 profile, Level-8.5 (Main tier)

x265 [info]: Thread pool created using 12 threads

x265 [info]: Slices                              : 1

x265 [info]: frame threads / pool features       : 3 / wpp(8 rows)

x265 [warning]: Source height &lt; 720p; disabling lookahead-slices

x265 [info]: Coding QT: max CU size, min CU size : 64 / 8

x265 [info]: Residual QT: max TU size, max depth : 32 / 1 inter / 1 intra

x265 [info]: ME / range / subpel / merge         : hex / 57 / 2 / 3

x265 [info]: Keyframe min / max / scenecut / bias: 25 / 250 / 40 / 5.00

x265 [info]: Cb/Cr QP Offset                     : 6 / 6

x265 [info]: Lookahead / bframes / badapt        : 20 / 4 / 2

x265 [info]: b-pyramid / weightp / weightb       : 1 / 1 / 0

x265 [info]: References / ref-limit  cu / depth  : 3 / off / on

x265 [info]: Rate Control                        : Lossless

x265 [info]: tools: rd=3 psy-rd=2.00 early-skip rskip signhide tmvp b-intra

x265 [info]: tools: strong-intra-smoothing deblock sao

Output #0, hevc, to 'R:\_\0.hvc':

  Metadata:

    encoder         : Lavf58.34.101

    Stream #0:0: Video: hevc (libx265), yuv444p, 799x501, q=2-31, 25 fps, 25 tbn, 25 tbc

    Metadata:

      encoder         : Lavc58.60.100 libx265

    Side data:

      cpb: bitrate max/min/avg: 0/0/0 buffer size: 0 vbv_delay: N/A

frame=    1 fps=0.0 q=-0.0 Lsize=      88kB time=00:00:00.04 bitrate=17930.0kbits/s speed=0.271x

video:88kB audio:0kB subtitle:0kB other streams:0kB global headers:0kB muxing overhead: 0.000000%

x265 [info]: frame I:      1, Avg QP:4.00  kb/s: 17516.60

x265 [info]: consecutive B-frames: 100.0% 0.0% 0.0% 0.0% 0.0%

x265 [info]: lossless compression ratio 4.57::1</blockquote>
yuv444其实对grayscale图像不会比yuv420增加多少容量，毕竟是hevc帧间编码处理全0数据而已，但是win的解码不支持yuv444<img src="https://static.saraba1st.com/image/smiley/face2017/065.png" referrerpolicy="no-referrer">

pix_fmt还可选gray，当然win的解码也不会支持的



﹍﹍﹍

评分





 参与人数 1战斗力 +1

|昵称|战斗力|理由|
|----|---|---|
| 冰箱研会长| + 1||



查看全部评分






*****

####  alien  
##### 81#       发表于 2020-5-6 12:19



 本帖最后由 alien 于 2020-5-6 12:37 编辑 

acdsee pro 2019或2020安装能直接看~不用安主楼的任何解码(又或者我win10不知什么时候安过类似的东西？) 靠的是ID_HEIC.apl 这个插件吧（哪个版本开始有的就不知了~）

但是acdsee看heic图片的颜色和webp有些不一样，就不知道是那边的解码问题了

然后我win7安的精简版和试用版ACDSEE本身都使用不正常~acdsee的文件管理器内点击图片都会出错退出，双击图片倒是正常观看~办公室电脑领导坚持用win7为求稳定~~。

win10下正常，但打进zip和rar里面的heic图片又看不了~散放的是正常观看的~

<img src="https://s12.directupload.net/images/200506/9lmlta58.png" referrerpolicy="no-referrer">










*****

####  冰箱研会长  
##### 82#         楼主| 发表于 2020-5-6 13:57



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47319213&amp;ptid=1931974" target="_blank">alien 发表于 2020-5-6 12:19</a>

acdsee pro 2019或2020安装能直接看~不用安主楼的任何解码(又或者我win10不知什么时候安过类似的东西？) 靠 ...</blockquote>
色彩空间的问题 webp一般也是yuv420的, 但是我那个函数是帧对RGB24做的色彩变幻, 如果直接从webp转的话就会出现这种颜色不一致的现象. 

一般来讲 jpg png什么的rgb24占大多数 所以我这个函数可以用

但新图像格式有不少是yuv的 这个换算就得斟酌一下

具体可以看主楼里面的外链, ffmpeg色彩空间变换那里, 写了常见空间转换使用的参数.







*****

####  冰箱研会长  
##### 83#         楼主| 发表于 2020-5-6 13:59



 本帖最后由 冰箱研会长 于 2020-5-6 14:51 编辑 

更新一下色彩空间科普吧... 这段其实我不是很熟 如果有错误大家积极指出.

<strong>已经鸽了, 太多了</strong>


就简单一写点关键词给后来者指路吧.


RGB

YUV

BT2020

BT601

BT656

转换矩阵

归一化

量化

线性空间


外部参考:
[http://joemaller.com/fcp/fxscript_yuv_color.shtml](http://joemaller.com/fcp/fxscript_yuv_color.shtml)
[https://zhuanlan.zhihu.com/p/24214731](https://zhuanlan.zhihu.com/p/24214731)
[https://zhuanlan.zhihu.com/p/24281841](https://zhuanlan.zhihu.com/p/24281841)
[https://en.wikipedia.org/wiki/YUV](https://en.wikipedia.org/wiki/YUV)








*****

####  gdsdjcb  
##### 84#       发表于 2020-5-6 15:51




也就是说用来无损压缩彩图不太可行，windows不兼容？<img src="https://static.saraba1st.com/image/smiley/face2017/066.png" referrerpolicy="no-referrer">







*****

####  冰箱研会长  
##### 85#         楼主| 发表于 2020-5-6 16:11



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47321397&amp;ptid=1931974" target="_blank">gdsdjcb 发表于 2020-5-6 15:51</a>

也就是说用来无损压缩彩图不太可行，windows不兼容？</blockquote>
是的 虽然可以使用yuv444进行无损彩图压缩 但是大部分软件都不兼容 楼上提到了一个专业级看图软件 似乎可以







*****

####  alien  
##### 86#       发表于 2020-5-6 16:43



 本帖最后由 alien 于 2020-5-6 17:26 编辑 

同一张HEIC图片

acdsee2020和win10安装插件自带浏览器对比~~颜色显示不正确是acdsee的锅（类似cmyk格式的颜色显示不正确吧？）

win10加插件后mangameeya加了插件也能看了，但依旧不能看压缩包里面的heic~
<img src="https://s12.directupload.net/images/200506/8covc4kz.png" referrerpolicy="no-referrer">

想自己试着转换格式~win10的powershell不会用~~按照主楼中间贴了2次代码都是出红色字表示不能执行~平板的win10版本不行还是什么的~~~

还是坐等exe执行文件吧~~~










*****

####  冰箱研会长  
##### 87#         楼主| 发表于 2020-5-6 18:46



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47322036&amp;ptid=1931974" target="_blank">alien 发表于 2020-5-6 16:43</a>

同一张HEIC图片

acdsee2020和win10安装插件自带浏览器对比~~颜色显示不正确是acdsee的锅（类似cmyk格式的颜 ...</blockquote>
[https://github.com/GrandArth/Risi-Pwsh-Profile](https://github.com/GrandArth/Risi-Pwsh-Profile)


我把我的配置文件放在这里了 既然你不用powershell 那就直接用的我配置文件就行

<img src="https://gitee.com/Arxher/Risiamu-Picture/raw/master/wikifiles/20200506184627.png" referrerpolicy="no-referrer">







*****

####  冰箱研会长  
##### 88#         楼主| 发表于 2020-5-6 19:03



<blockquote><a href="httphttps://bbs.saraba1st.com/2b/forum.php?mod=redirect&amp;goto=findpost&amp;pid=47313731&amp;ptid=1931974" target="_blank">SmterC 发表于 2020-5-5 21:38</a>

试了一下，安卓上用的本地漫画软件comic screen支持webp但不支持heic。毕竟webp是谷歌亲儿子吧，大部分安卓 ...</blockquote>
自从看了你这个回复 我就一直在思考直接用pwsh调用libheif, libx265的dll, 这样就不需要其他的依赖了... 







*****

####  黑夜守望者  
##### 89#       发表于 2020-5-15 22:04



 本帖最后由 黑夜守望者 于 2020-5-15 23:23 编辑 

LZ我用了你GitHub的配置文件，打开power shell有很多乱码，我也没管它输入了我的路径和想转换的格式，转换的时候我看着是有.heic和.hev（？忘了后缀了）的文件生成，但是全部转换完连同我的原图一起消失了，只剩下我的文件夹空荡荡的<img src="https://static.saraba1st.com/image/smiley/face2017/135.png" referrerpolicy="no-referrer">


又试了png转jpg，就不会出现这种情况。但是只要一转成heic，整个文件夹就会被清空



搞定了，把LZ的配置文件第50--52行删掉就行了，缺点就是会保留个不知道干什么的.hvc文件，直接编辑ps1文件再把LZ的配置内容复制进去可以解决乱码问题。转成HEIC的压缩率非常牛逼，但是不知道为啥png转成jpg反而更大了<img src="https://static.saraba1st.com/image/smiley/face2017/003.png" referrerpolicy="no-referrer">），果然是漫画专用的






捕获.JPG
(297.32 KB, 下载次数: 0)




下载附件


2020-5-15 22:01 上传









<img src="https://img.saraba1st.com/forum/202005/15/220125dbtf2wgpgrzcg3bt.jpg" referrerpolicy="no-referrer">












*****

####  bigheadnotbig  
##### 90#       发表于 2020-5-15 22:27



<img src="https://static.saraba1st.com/image/smiley/face2017/074.png" referrerpolicy="no-referrer">lz加油 坛友们的硬盘需要你的拯救 我64g的ipad也需要拯救！







*****

####  aji47  
##### 91#       发表于 2020-5-15 22:38




lz，最近好多漫画24页64g。转换成webp如何？
转换速度快吗？我想给我上次那个漫画器加额外功能了





                                              